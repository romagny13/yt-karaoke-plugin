(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=factory()}else{global.Karaoke=factory()}})(typeof window!=="undefined"?window:this,(function(){"use strict";function loadScript(){return new Promise(((resolve,reject)=>{if(window.YT&&YT.Player){resolve();return}const script=document.createElement("script");script.src="https://www.youtube.com/iframe_api";script.onload=()=>{waitForYouTubeAPI(resolve,reject)};script.onerror=err=>reject(err);document.body.appendChild(script)}))}function waitForYouTubeAPI(resolve,reject){const checkInterval=setInterval((()=>{if(window.YT&&YT.Player){clearInterval(checkInterval);resolve()}}),100)}class YouTubeKaraokePlugin{constructor(config={}){this.instanceId="karaoke-"+Math.random().toString(36).substr(2,9);this.config={colors:{primaryColor:config.colors?.primaryColor||"#ff69b4",secondaryColor:config.colors?.secondaryColor||"#ff1493",accentColor:config.colors?.accentColor||"#ff8faf",backgroundColor:config.colors?.backgroundColor||"#1a0f1f",textColor:config.colors?.textColor||"#fff",glowColor1:config.colors?.glowColor1||"#ffd700",glowColor2:config.colors?.glowColor2||"#fff200"},floatingSymbol:config.floatingSymbol||"â™¥",videoId:config.videoId||"",lyrics:config.lyrics||[],containerId:config.containerId||"karaoke",font:config.font||"Dancing Script",shadows:{defaultBoxShadow:config.shadows?.defaultBoxShadow||"0 0 20px rgba(255, 215, 0, 0.2), 0 0 40px rgba(255, 105, 180, 0.2), inset 0 0 60px rgba(255, 242, 0, 0.1)",hoverBoxShadow:config.shadows?.hoverBoxShadow||"0 5px 15px rgba(0, 0, 0, 0.5), 0 10px 20px rgba(255, 105, 180, 0.4), inset 0 0 60px rgba(255, 242, 0, 0.1)"}};this.currentLineIndex=-1;this.init()}init(){this.injectStyles();this.createStructure();loadScript().then((()=>this.createPlayer())).catch((error=>console.error("Erreur lors du chargement de l'API YouTube :",error)))}injectStyles(){const styleId=`karaoke-styles-${this.instanceId}`;if(!document.getElementById(styleId)){const style=document.createElement("style");style.id=styleId;style.textContent=`\n          @import url('https://fonts.googleapis.com/css2?family=${this.config.font.replace(" ","+")}:wght@400;700&display=swap');\n\n          #${this.instanceId} .karaoke {\n            --romantic-primary: ${this.config.colors.primaryColor};\n            --romantic-secondary: ${this.config.colors.secondaryColor};\n            --romantic-accent: ${this.config.colors.accentColor};\n            --romantic-bg: ${this.config.colors.backgroundColor};\n            --romantic-text: ${this.config.colors.textColor};\n            --viral-glow1: ${this.config.colors.glowColor1};\n            --viral-glow2: ${this.config.colors.glowColor2};\n\n            height: 0;\n            padding: 0;\n            margin: 0;\n            opacity: 0;\n            overflow: hidden;\n            background: linear-gradient(\n              135deg,\n              ${this.config.colors.backgroundColor}f2 0%,\n              ${this.config.colors.backgroundColor}e6 50%,\n              ${this.config.colors.backgroundColor}f2 100%\n            );\n            border-radius: 30px;\n            border: 1px solid var(--romantic-primary);\n            position: relative;\n            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);\n          }\n\n          #${this.instanceId} .karaoke.expand {\n            height: auto;\n            min-height: 200px;\n            padding: 2rem;\n            margin: 1rem 0;\n            opacity: 1;\n            animation: appearWithLove-${this.instanceId} 1.2s cubic-bezier(0.4, 0, 0.2, 1);\n            box-shadow: ${this.config.shadows.defaultBoxShadow};\n            transition: all 0.5s ease;\n          }\n\n          #${this.instanceId} .karaoke.expand:hover {\n            transform: translateY(-5px) scale(1.01);\n            box-shadow: ${this.config.shadows.hoverBoxShadow};\n          }\n\n          #${this.instanceId} .karaoke.expand:hover::before {\n            animation: glowingLove-${this.instanceId} 4s infinite alternate,\n                      particleShift-${this.instanceId} 8s infinite linear;\n          }\n\n          #${this.instanceId} .karaoke::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background:\n              radial-gradient(circle at 30% 20%, var(--romantic-secondary) 0%, transparent 50%),\n              radial-gradient(circle at 70% 80%, var(--romantic-primary) 0%, transparent 50%);\n            opacity: 0;\n            transition: opacity 1s ease;\n            pointer-events: none;\n            border-radius: inherit;\n          }\n\n          #${this.instanceId} .karaoke.expand::before {\n            opacity: 1;\n            animation: glowingLove-${this.instanceId} 4s infinite alternate;\n          }\n\n          #${this.instanceId} .karaoke.expand::after {\n            content: '${this.config.floatingSymbol}';\n            position: absolute;\n            color: var(--romantic-primary);\n            font-size: 1.5rem;\n            pointer-events: none;\n            animation: floatingSymbols-${this.instanceId} 3s infinite;\n            opacity: 0;\n          }\n\n          #${this.instanceId} .karaoke.expand > div::before,\n          #${this.instanceId} .karaoke.expand > div::after {\n            content: '${this.config.floatingSymbol}';\n            position: absolute;\n            color: var(--viral-glow1);\n            font-size: 1.2rem;\n            pointer-events: none;\n            opacity: 0;\n          }\n\n          #${this.instanceId} .karaoke.expand > div::before {\n            left: 20%;\n            animation: floatingSymbols-${this.instanceId} 4s infinite 1s;\n          }\n\n          #${this.instanceId} .karaoke.expand > div::after {\n            right: 20%;\n            animation: floatingSymbols-${this.instanceId} 3.5s infinite 0.5s;\n          }\n\n          #${this.instanceId} .line {\n            font-family: '${this.config.font}', cursive;\n            font-size: 2.2rem;\n            color: var(--romantic-text);\n            text-align: center;\n            opacity: 0;\n            position: relative;\n            transition: all 0.4s ease;\n            transform: scale(0.9) translateY(20px);\n            width: 100%;\n            padding: 0.5rem;\n            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);\n            cursor: default;\n          }\n\n          #${this.instanceId} .line.highlight {\n            opacity: 1;\n            background: linear-gradient(45deg, var(--romantic-primary), var(--viral-glow1));\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            transform: scale(1) translateY(0);\n            animation: heartbeat-${this.instanceId} 2s infinite,\n                      viralGlow-${this.instanceId} 3s infinite alternate;\n          }\n\n          #${this.instanceId} .line.waiting {\n            opacity: 0.6;\n            color: rgba(255, 255, 255, 0.7);\n            font-size: 1.4rem;\n            transform: scale(0.85) translateY(0);\n            filter: blur(0.5px);\n          }\n\n          #${this.instanceId} .line.waiting:hover {\n            opacity: 0.8;\n            transform: scale(0.87);\n            filter: blur(0);\n            color: rgba(255, 255, 255, 0.9);\n            text-shadow:\n              0 0 10px var(--viral-glow1),\n              0 0 20px var(--romantic-primary);\n          }\n\n          @keyframes appearWithLove-${this.instanceId} {\n            0% {\n              opacity: 0;\n              transform: scale(0.8) translateY(30px);\n              filter: blur(10px);\n            }\n            50% {\n              opacity: 0.5;\n              transform: scale(1.02) translateY(15px);\n              filter: blur(5px);\n            }\n            100% {\n              opacity: 1;\n              transform: scale(1) translateY(0);\n              filter: blur(0);\n            }\n          }\n\n          @keyframes glowingLove-${this.instanceId} {\n            0% {\n              filter: blur(10px) brightness(1);\n            }\n            100% {\n              filter: blur(15px) brightness(1.3);\n            }\n          }\n\n          @keyframes particleShift-${this.instanceId} {\n            0% {\n              background-position: 0% 0%;\n            }\n            100% {\n              background-position: 200% 0%;\n            }\n          }\n\n          @keyframes floatingSymbols-${this.instanceId} {\n            0% {\n              transform: translateY(0) rotate(0deg);\n              opacity: 0;\n            }\n            50% {\n              opacity: 0.6;\n            }\n            100% {\n              transform: translateY(-100px) rotate(360deg);\n              opacity: 0;\n            }\n          }\n\n          @keyframes heartbeat-${this.instanceId} {\n            0%, 100% { transform: scale(1); }\n            5% { transform: scale(1.02); }\n            10% { transform: scale(1); }\n            15% { transform: scale(1.02); }\n            20%, 100% { transform: scale(1); }\n          }\n\n          @keyframes viralGlow-${this.instanceId} {\n            0% {\n              text-shadow:\n                0 0 10px var(--viral-glow1),\n                0 0 20px var(--romantic-primary),\n                0 0 30px var(--viral-glow2);\n            }\n            100% {\n              text-shadow:\n                0 0 15px var(--viral-glow1),\n                0 0 30px var(--romantic-primary),\n                0 0 45px var(--viral-glow2);\n            }\n          }\n\n          @media (max-width: 768px) {\n            #${this.instanceId} .karaoke.expand {\n              padding: 1.5rem;\n              margin: 0.5rem;\n            }\n\n            #${this.instanceId} .line {\n              font-size: 1.8rem;\n            }\n\n            #${this.instanceId} .line.waiting {\n              font-size: 1.2rem;\n            }\n\n            #${this.instanceId} .karaoke.expand:hover {\n              transform: translateY(-3px) scale(1.005);\n            }\n          }\n        `;document.head.appendChild(style)}}createStructure(){const container=document.getElementById(this.config.containerId);if(!container){console.error(`Container with id "${this.config.containerId}" not found`);return}const wrapper=document.createElement("div");wrapper.id=this.instanceId;wrapper.innerHTML=`\n        <div class="video-container">\n          <div id="player-${this.instanceId}"></div>\n        </div>\n        <div class="karaoke" id="karaoke-box-${this.instanceId}">\n          <div class="lyrics-container" id="lyrics-container-${this.instanceId}"></div>\n        </div>\n      `;container.appendChild(wrapper)}createPlayer(){this.player=new YT.Player(`player-${this.instanceId}`,{videoId:this.config.videoId,events:{onStateChange:event=>this.onPlayerStateChange(event)}})}onPlayerStateChange(event){if(event.data===YT.PlayerState.PLAYING){this.startLyricsSync()}}startLyricsSync(){const interval=setInterval((()=>{const currentTime=this.player.getCurrentTime();this.displayLyrics(currentTime);if(currentTime>=this.config.lyrics[this.config.lyrics.length-1].time){clearInterval(interval)}}),100)}displayLyrics(currentTime){const lineIndex=this.getCurrentLineIndex(currentTime);const lyricsContainer=document.getElementById(`lyrics-container-${this.instanceId}`);const karaokeBox=document.getElementById(`karaoke-box-${this.instanceId}`);if(lineIndex!==this.currentLineIndex&&lineIndex!==-1){const line=this.config.lyrics[lineIndex];const lineElement=document.createElement("div");lineElement.classList.add("line");lineElement.innerHTML=line.text;lyricsContainer.appendChild(lineElement);if(this.currentLineIndex===-1){karaokeBox.classList.add("expand")}const lines=lyricsContainer.children;for(let i=0;i<lines.length;i++){if(lines[i]!==lineElement){lines[i].classList.add("waiting");lines[i].classList.remove("highlight")}}setTimeout((()=>{lineElement.classList.add("highlight")}),0);this.currentLineIndex=lineIndex;if(lyricsContainer.children.length>3){lyricsContainer.removeChild(lyricsContainer.firstChild)}}}getCurrentLineIndex(currentTime){let currentIndex=-1;for(let i=0;i<this.config.lyrics.length;i++){if(this.config.lyrics[i].time<=currentTime){currentIndex=i}}return currentIndex}}return{YouTubeKaraokePlugin:YouTubeKaraokePlugin}}));